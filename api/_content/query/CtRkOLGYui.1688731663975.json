{"_path":"/examples/send-payment","_dir":"examples","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Sending Payments","description":"This example shows how to send a payment from one account to another via the Gevamu Payments Solution.","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"sending-payments"},"children":[{"type":"text","value":"Sending Payments"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This example shows how to send a payment from one account to another via the Gevamu Payments Solution."}]},{"type":"element","tag":"mermaid","props":{"code":"Y2xhc3NEaWFncmFtCiAgY2xhc3MgR2V2YW11RmFjYWRlIHsKICAgICsgc2VuZFBheW1lbnQoKQogIH0="},"children":[]},{"type":"element","tag":"h2","props":{"id":"implementation"},"children":[{"type":"text","value":"Implementation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sending a payment is a one-step operation, consisting of a single "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PaymentFlow"}]},{"type":"text","value":" call."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before starting the flow, provide a payment instruction created according to a chosen payment standard:"}]},{"type":"element","tag":"code","props":{"code":"class ClientApplication(private val gevamuFacade: GevamuFacade) {\n    fun sendPaymentViaGevamu() {\n        // Create payment instruction with payment details\n        val paymentInstruction = PaymentInstruction(/* payment details */)\n        \n        // Specify gateway node for payment processing\n        val gateway = Party(/* gateway node data */)\n        \n        // Use GevamuFacade to send payment instruction to gateway node\n        gevamuFacade.sendPayment(paymentInstruction, gateway)\n    }\n}\n\nclass GevamuFacade(private val serviceHub: AppServiceHub): SingletonSerializeAsToken() {\n  fun sendPayment(\n    paymentInstruction: PaymentInstruction,\n    gateway: Party\n  ): List<StateAndRef<Payment>> {\n    val flowHandle = serviceHub.startFlow(PaymentFlow(paymentInstruction, gateway))\n    return flowHandle.returnValue.get()\n  }\n}\n","language":"kotlin","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"ClientApplication"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"gevamuFacade"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"GevamuFacade"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"fun"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-5f5704"},"children":[{"type":"text","value":"sendPaymentViaGevamu"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"() {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-c1ee75"},"children":[{"type":"text","value":"// Create payment instruction with payment details"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" paymentInstruction "}]},{"type":"element","tag":"span","props":{"class":"ct-42f847"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"PaymentInstruction"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-c1ee75"},"children":[{"type":"text","value":"/* payment details */"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-c1ee75"},"children":[{"type":"text","value":"// Specify gateway node for payment processing"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" gateway "}]},{"type":"element","tag":"span","props":{"class":"ct-42f847"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"Party"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-c1ee75"},"children":[{"type":"text","value":"/* gateway node data */"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-c1ee75"},"children":[{"type":"text","value":"// Use GevamuFacade to send payment instruction to gateway node"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"        gevamuFacade.sendPayment(paymentInstruction, gateway)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"}"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"GevamuFacade"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"serviceHub"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"AppServiceHub"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"SingletonSerializeAsToken"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"() {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"fun"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-5f5704"},"children":[{"type":"text","value":"sendPayment"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"paymentInstruction"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"PaymentInstruction"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"gateway"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"Party"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"  ): "}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"List"}]},{"type":"element","tag":"span","props":{"class":"ct-42f847"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"StateAndRef"}]},{"type":"element","tag":"span","props":{"class":"ct-42f847"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-42f847"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" flowHandle "}]},{"type":"element","tag":"span","props":{"class":"ct-42f847"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" serviceHub.startFlow("}]},{"type":"element","tag":"span","props":{"class":"ct-7708c0"},"children":[{"type":"text","value":"PaymentFlow"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"(paymentInstruction, gateway))"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-7ccc5b"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":" flowHandle.returnValue.get()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"  }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-5c5fd6"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"transaction-lifecycle"},"children":[{"type":"text","value":"Transaction lifecycle"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When creating a payment transaction, use one of the formats listed in "},{"type":"element","tag":"a","props":{"href":"https://gevamu.github.io/corda-payments-sdk/payments-workflows/com.gevamu.corda.flows/-payment-instruction-format/index.html","rel":["nofollow"],"target":"_blank"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"PaymentInstructionFormat"}]}]},{"type":"text","value":" enum."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once a payment instruction is received, the Gevamu Payment Solution validates the payment by checking the Participant node's identity and the Participant ID, and authorizes it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the validation passes, the Payment Gateway sets the payment status to ‘Sent to Gateway’ and communicates the status change back to the Participant's node."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If a payment initiation request contains multiple payment instructions, multiple payment states will be created and independently updated."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the side of the Payment Services Provider, the transaction can be accepted or rejected.\nIf payment cannot be immediately completed, the \"Pending\" status is returned.\nOnce the Gevamu Payment Gateway receives a new status from the PSP, the payment state will be updated with the final status."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can find sequence diagrams of payment processing and payment state transition below:"}]},{"type":"element","tag":"mermaid","props":{"code":"c2VxdWVuY2VEaWFncmFtCiAgcGFydGljaXBhbnQgQ0EgYXMgQ2xpZW50QXBwbGljYXRpb24KICBwYXJ0aWNpcGFudCBQQ0QgYXMgR2V2YW11RmFjYWRlCgogIENBLT4+UENEOiBJbml0aWF0ZSBQYXltZW50CiAgUENELT4+UENEOiBJbml0aWF0ZSBwYXltZW50IDxici8+IHdpdGhpbiBQU1AKICBQQ0QtPj5DQTogUGF5bWVudCBzdGF0dXM6IENyZWF0ZWQKICBQQ0QtPj5QQ0Q6IFBhc3NpdmUgcGF5bWVudCB1cGRhdGUuLi4KICBOb3RlIG92ZXIgQ0EsUENEOiBBZnRlciBzdGF0ZSBjaGFuZ2UKICBDQS0+PlBDRDogUXVlcnkgcGF5bWVudAogIFBDRC0+PkNBOiBQYXltZW50IHdpdGggcmVsZXZhbnQgc3RhdHVz"},"children":[]},{"type":"element","tag":"notice","props":{":info":"true","info":true},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Find more information about payment queries "},{"type":"element","tag":"a","props":{"href":"/examples/query-payment-states"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"mermaid","props":{"code":"c3RhdGVEaWFncmFtLXYyCiAgICBTZW50OiBTZW50IHRvIEdhdGV3YXkKICAgIFsqXSAtLT4gQ3JlYXRlZAogICAgQ3JlYXRlZCAtLT4gU2VudAogICAgU2VudCAtLT4gUGVuZGluZwogICAgU2VudCAgLS0+IEFjY2VwdGVkCiAgICBTZW50ICAtLT4gUmVqZWN0ZWQKICAgIFBlbmRpbmcgLS0+IEFjY2VwdGVkCiAgICBQZW5kaW5nIC0tPiBSZWplY3RlZAogICAgQWNjZXB0ZWQgLS0+IFsqXQogICAgUmVqZWN0ZWQgLS0+IFsqXQ=="},"children":[]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-42f847{color:#56B6C2}\n.ct-c1ee75{color:#7F848E}\n.ct-5f5704{color:#61AFEF}\n.ct-7708c0{color:#E5C07B}\n.ct-5c5fd6{color:#ABB2BF}\n.ct-7ccc5b{color:#C678DD}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"implementation","depth":2,"text":"Implementation"},{"id":"transaction-lifecycle","depth":2,"text":"Transaction lifecycle"}]}},"_type":"markdown","_id":"content:4.examples:send-payment.md","_source":"content","_file":"4.examples/send-payment.md","_extension":"md"}