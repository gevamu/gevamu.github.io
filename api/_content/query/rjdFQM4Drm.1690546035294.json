{"_path":"/examples/query-payment-states","_dir":"examples","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Payment state queries","description":"Corda stores the state of a payment in the vault of the node that initiated the payment, so you can access the state of a payment by querying the vault.","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"payment-state-queries"},"children":[{"type":"text","value":"Payment state queries"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Corda stores the state of a payment in the vault of the node that initiated the payment, so you can access the state of a payment by querying the vault."}]},{"type":"element","tag":"mermaid","props":{"code":"Y2xhc3NEaWFncmFtCiAgY2xhc3MgTXlQYXltZW50U2VydmljZSB7CiAgICArIHF1ZXJ5UGF5bWVudHNWaWFHZXZhbXUoKQogIH0KICBjbGFzcyBHZXZhbXVGYWNhZGUgewogICAgKyBnZXRQYXltZW50KCkKICAgICsgcXVlcnlQYXltZW50cygpCiAgfQoKICBNeVBheW1lbnRTZXJ2aWNlIC4uPiBHZXZhbXVGYWNhZGU="},"children":[]},{"type":"element","tag":"h2","props":{"id":"payment-state-structure"},"children":[{"type":"text","value":"Payment state structure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The structure of the "},{"type":"element","tag":"a","props":{"href":"https://gevamu.github.io/corda-payments-sdk/payments-contracts/com.gevamu.corda.states/-payment/index.html","rel":["nofollow"],"target":"_blank"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Payment"}]}]},{"type":"text","value":" state is as follows:"}]},{"type":"element","tag":"mermaid","props":{"code":"Y2xhc3NEaWFncmFtCiAgY2xhc3MgUGF5bWVudCB7CiAgICArIHBheWVyOiBQYXJ0eQogICAgKyBnYXRld2F5OiBQYXJ0eQogICAgKyBlbmRUb0VuZElkOiBTdHJpbmcKICAgICsgcGF5bWVudEluc3RydWN0aW9uSWQ6IEF0dGFjaG1lbnRJZAogICAgKyBzdGF0dXM6IFBheW1lbnRTdGF0dXMKICAgICsgYWRkaXRpb25hbEluZm86IFN0cmluZz8KICAgICsgdW5pcXVlUGF5bWVudElkOiBVVUlECiAgICArIHRpbWVzdGFtcDogSW5zdGFudAogIH0KCiAgY2xhc3MgUGF5bWVudFN0YXR1c3sKICAgIDw8ZW51bWVyYXRpb24+PgogICAgQ1JFQVRFRAogICAgU0VOVF9UT19HQVRFV0FZCiAgICBBQ0NFUFRFRAogICAgUEVORElORwogICAgQ09NUExFVEVECiAgICBSRUpFQ1RFRAogIH0KCiAgY2xhc3MgQXR0YWNobWVudCB7CiAgICA8PGludGVyZmFjZT4+CiAgICArIGlkOiBTZWN1cmVIYXNoCiAgICArIG9wZW4oKTogSW5wdXRTdHJlYW0KICB9CgogIFBheW1lbnQgby0tIFBheW1lbnRTdGF0dXMKICBQYXltZW50IC4uIEF0dGFjaG1lbnQ6IHBheW1lbnRJbnN0cnVjdGlvbklkIC0tPiBpZA=="},"children":[]},{"type":"element","tag":"notice","props":{":info":"true","info":true},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that a full payment instruction is stored as a Corda "},{"type":"element","tag":"a","props":{"href":"https://docs.r3.com/en/api-ref/corda/4.8/open-source/javadoc/net/corda/core/contracts/Attachment.html","rel":["nofollow"],"target":"_blank"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Attachment"}]}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"h2","props":{"id":"vault-queries"},"children":[{"type":"text","value":"Vault queries"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Every Corda node has a vault that stores all the states created by the node (in our case, the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Payment"}]},{"type":"text","value":" states)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Corda provides a powerful query language to search for states in the vault â€“ learn more about "},{"type":"element","tag":"a","props":{"href":"https://docs.r3.com/en/platform/corda/4.7/enterprise/cordapps/api-vault-query.html","rel":["nofollow"],"target":"_blank"},"children":[{"type":"text","value":"Writing vault queries"}]},{"type":"text","value":" in Corda documentation."}]},{"type":"element","tag":"notice","props":{":warning":"true","warning":true},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Gevamu SDK doesn't provide any ready-to-use solution for querying by payments details stored in the attachment. However, you can create additional tables with the information specific to your business needs and use them in vault queries.\nTo get all payment details from the attachment, download and deserialize it."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To create queries for the Gevamu payments, use the following imports:"}]},{"type":"element","tag":"code","props":{"code":"// Corda imports\nimport net.corda.core.node.services.vault.QueryCriteria\n// Gevamu SDK imports\nimport com.gevamu.corda.schema.PaymentSchemaV1\nimport com.gevamu.corda.states.Payment\n","language":"kotlin","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Corda imports"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"net.corda.core.node.services.vault.QueryCriteria"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Gevamu SDK imports"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.schema.PaymentSchemaV1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.states.Payment"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"getting-a-single-payment"},"children":[{"type":"text","value":"Getting a single payment"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To find a unique payment, search by the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"uniquePaymentId"}]},{"type":"text","value":" field, accepted by the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"getPayment"}]},{"type":"text","value":" method as a parameter."}]},{"type":"element","tag":"code","props":{"code":"import java.util.UUID\nimport net.corda.core.node.services.vault.QueryCriteria\nimport com.gevamu.corda.schema.PaymentSchemaV1\nimport com.gevamu.corda.states.Payment\n\nclass GevamuFacade {\n    fun getPayment(uniquePaymentId: UUID): StateAndRef<Payment>? {\n        // Create custom query criteria to search by id\n        val criteria = QueryCriteria.VaultCustomQueryCriteria(\n            // Pay attention to method `equal` here. It is not `equals`!\n            PaymentSchemaV1.PersistentPayment::uniquePaymentId.equal(uniquePaymentId)\n        )\n        // Query vault and return single payment state\n        return serviceHub.vaultService.queryBy<Payment>(criteria).states.singleOrNull()\n    }\n}\n","language":"kotlin","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"java.util.UUID"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"net.corda.core.node.services.vault.QueryCriteria"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.schema.PaymentSchemaV1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.states.Payment"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"GevamuFacade"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"fun"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ac5608"},"children":[{"type":"text","value":"getPayment"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"uniquePaymentId"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"UUID"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"StateAndRef"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"? {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Create custom query criteria to search by id"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" criteria "}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"QueryCriteria"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"VaultCustomQueryCriteria"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Pay attention to method `equal` here. It is not `equals`!"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"PaymentSchemaV1"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"PersistentPayment"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"::uniquePaymentId.equal(uniquePaymentId)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        )"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Query vault and return single payment state"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" serviceHub.vaultService.queryBy"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"(criteria).states.singleOrNull()"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"payment-queries"},"children":[{"type":"text","value":"Payment queries"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Search criteria for payments can be unique to particular business use cases. The following example shows a generic method for querying payments."}]},{"type":"element","tag":"code","props":{"code":"import net.corda.core.node.services.vault.QueryCriteria\nimport com.gevamu.corda.states.Payment\n\nclass GevamuFacade {\n    fun queryPayments(criteria: QueryCriteria): List<StateAndRef<Payment>> {\n        // Query vault and return list of payment states\n        return serviceHub.vaultService.queryBy<Payment>(criteria).states\n    }\n}\n","language":"kotlin","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"net.corda.core.node.services.vault.QueryCriteria"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.states.Payment"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"GevamuFacade"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"fun"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ac5608"},"children":[{"type":"text","value":"queryPayments"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"criteria"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"QueryCriteria"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"List"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"StateAndRef"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Query vault and return list of payment states"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" serviceHub.vaultService.queryBy"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"(criteria).states"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"payment-queries-by-date-range"},"children":[{"type":"text","value":"Payment queries by date range"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Querying objects by a date range is a common task for different business domains. The following example shows how to implement this functionality in relation to the Gevamu Payment solution:"}]},{"type":"element","tag":"code","props":{"code":"import java.time.Instant\nimport net.corda.core.node.services.vault.QueryCriteria\nimport com.gevamu.corda.schema.PaymentSchemaV1\nimport com.gevamu.corda.states.Payment\n\nclass GevamuFacade {\n    fun queryPaymentsByDateRange(from: Instant, to: Instant): List<StateAndRef<Payment>> {\n        // Create custom query criteria to search by date range\n        val criteria = QueryCriteria.VaultCustomQueryCriteria(\n            PaymentSchemaV1.PersistentPayment::timestamp.between(from, to)\n        )\n        // Query vault and return list of payment states\n        return serviceHub.vaultService.queryBy<Payment>(criteria).states\n    }\n}\n","language":"kotlin","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"java.time.Instant"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"net.corda.core.node.services.vault.QueryCriteria"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.schema.PaymentSchemaV1"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"com.gevamu.corda.states.Payment"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"GevamuFacade"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"fun"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-ac5608"},"children":[{"type":"text","value":"queryPaymentsByDateRange"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Instant"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"to"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Instant"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"List"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"StateAndRef"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":">>"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Create custom query criteria to search by date range"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"val"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" criteria "}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"QueryCriteria"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"VaultCustomQueryCriteria"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"PaymentSchemaV1"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"PersistentPayment"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"::timestamp.between(from, to)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        )"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-d67fea"},"children":[{"type":"text","value":"// Query vault and return list of payment states"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-adf3f5"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":" serviceHub.vaultService.queryBy"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-e0697a"},"children":[{"type":"text","value":"Payment"}]},{"type":"element","tag":"span","props":{"class":"ct-faec83"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"(criteria).states"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-37e6b2"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-faec83{color:#56B6C2}\n.ct-ac5608{color:#61AFEF}\n.ct-e0697a{color:#E5C07B}\n.ct-37e6b2{color:#ABB2BF}\n.ct-adf3f5{color:#C678DD}\n.ct-d67fea{color:#7F848E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"payment-state-structure","depth":2,"text":"Payment state structure"},{"id":"vault-queries","depth":2,"text":"Vault queries"},{"id":"getting-a-single-payment","depth":2,"text":"Getting a single payment"},{"id":"payment-queries","depth":2,"text":"Payment queries","children":[{"id":"payment-queries-by-date-range","depth":3,"text":"Payment queries by date range"}]}]}},"_type":"markdown","_id":"content:4.examples:query-payment-states.md","_source":"content","_file":"4.examples/query-payment-states.md","_extension":"md"}